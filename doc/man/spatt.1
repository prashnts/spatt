.TH SSPATT "February 3rd, 2005"
.SH NAME
SPATT \- Statistics for Patterns, based on simple models.
.SH SYNOPSIS
.B [s|g|ld|x|cp]spatt
.RI [-hVqvdb] [--debug-level=<level>] [-a descriptor] [FASTA sequence] [-M <filename>] [-S <filename>] [-U <filename>] [-C <filename>] [-P <filename>] [-l <max>] [-p descriptor]... [-m <order>] [--all-words] [--normalize] [--max-pvalue <threshold>]
.SH GENERAL DESCRIPTION
\fBspatt (statistic for patterns)\fP is a suite of programs designed for the computation
of pattern occurrencies p-value on text. Assuming the text is generated according to Markov
model, the p-value of a given observation is its probability to occur. The lower is the p-value,
the more unlikely is the observation. For example, this tools can be used to find patterns with
unusual behaviour in DNA sequences.

Let us note N(P) the number of occurrences of a pattern P on a given sequence. If we consider
the sequence is random (according to a model of our choice), N(P) become a random variable and
we can associate p-values to observations using the following statistic:

S = - log10[ P( N(P) > Nobs(P) ) ] when P is seen more than expected

and

S = +log10[ P( N(P) < Nobs(P) ) ] when P is seen less than expected

For example S=+3.23 means the pattern is over-represented (seen more than expected) with a p-value
of 10^-3.23 = 5.888e-4. S=-12.67 means the pattern is under-represented (seen less than expected)
with a p-value of 10^-12.67 = 2.138e-13.

.SH AVAILABLE PROGRAMS
Several programs are provided based on different statistics methods and they all share the same syntax
and options (even if few of them are specific to a given program):

\fBsspatt (simple statistics for patterns)\fP compute p-value using binomial approximation.
This approximation is known to be false but is in fact a very fast and reliable heuristic.

\fBgspatt (gaussian statistics for patterns)\fP compute expectation and variance for pattern
counts and derive from these a p-value approximation.

\fBldspatt (large deviations statistics for patterns)\fP is based on the large deviations theory,
the computed p-value are especially reliable for the smallest but are asymptotic and so must be used
with care on short sequences (let say less than 10000 long). 

\fBxspatt (exact statistics for patterns)\fP proposes to use exact computations with arbitrary precision
methods to give high quality p-value. Memory requirements are growing linearly with sequence length and
time complexity is proportional both to sequence length and pattern number of occurrences.
Therefore, this method should be used only on short sequence (let say less than 10000 long).

\fBcpspatt (compound poisson statistics for patterns)\fP use Chen-Stein method to approximate N(P)
with a geometric Poisson distribution. Thanks to a nice recurrence, p-values computations are linear
(and not quadratic) with the observed number of occurrences. In the case of non overlapping patterns,
these approximations fall back to the simple Poisson approximation which is very close to the binomial
statistics implemented in sspatt. 

.SH ARGUMENTS
.TP
.B FASTA sequence
The name of the file containing a sequence in FASTA format.

.SH OPTIONS

.TP
.B \-h, --help
displays this message.
.TP
.B \-v, --version
displays version number.
.TP
.B \-q, --quiet
quiet output (same effect as --debug-level -1).
.TP
.B \-V, --Verbose
verbose output (same effect as --debug-level 1).
.TP
.B \-d, --debug
debug output (same effect as --debug-level 2).
.TP
.B \--debug-level=level
set the verbose level:
 -1 (quiet),
 0 (normal),
 1 (verbose)
 2 and more (debug).
.TP
.B \-a, --alphabet=descriptor
define the alphabet to use (ex: -a "acgt:tgca" for standard DNA
alphabet).
.TP
.B \-M, --Markov-file=filename
destination file for the Markov model parameters.
.TP
.B \-S, --Stationnary-file=filename
destination file for the stationnary distribution.
.TP
.B \-U, --Use-markov-file=filename
file containing the Markov model parameters.
.TP
.B \-C, --Count-file=filenamme
file containing word counts.
.TP
.B \-P, --Pattern-file=filename
file containing patterns.
.TP
.B \-l, --length=max
length of the longest word counted.
.TP
.B \-p, --pattern=descriptor
define a pattern (could be used several times).
.TP
.B \-b, --both-strands
count patterns on both strands.
.TP
.B \-m, --markov=order
order of the Markov model.
.TP
.B \--all-words
process all words of the given length.
.TP
.B \-n, \--normalize 
statistics are normalized by the length of the sequence.
.TP
.B --max-pvalue <threshold>
only statistics corresponding to pvalue lower than the threshold are produced

.SH MORE DETAILS ON OPTIONS

\fBAlphabet descriptor\fP

this allows to specify the alphabet you want to use reading sequence and patterns. First, each letter of the alphabet must be given as an ordered sequence, each letter must be either a simple caracter either a list of caracter between two brackets. Then, optionnally, a complementary alphabet could be specified after a ":". Only one caracter per letter should be used in this way.

By default, white space (blanks, tabulations, carriage returns, ...) are ignored and alphabets are considered not to be case sensitible unless two different cases have been used in alphabet descriptor.

Each time a invalid caracter is found in a sequence, it is considered as an interruption and has therefore the same result than the separation of the sequence in two different pieces.

Here follows some examples of valid descriptors: 

.IP
"acgt:tgca" for the standard DNA alphabet (this is also the default alphabet)
.PP

.IP
"[ag][ct]" for the purin-pyrimidin alphabet
.PP

.IP
"abcdefghijklmnopkrstuv" for the standard latin alphabet
.PP

.IP
"acgtN" for a custom case sensitive DNA alphabet including the letter N
.PP

.IP
"[ARNDCE][QGHI][LKM][FPST][WYV]" for amino-acid alphabet divided in five groups
.PP

.IP
"ARNDCEQGHILKMFPSTWYV" for the full amin-acid alphabet
.PP

\fBPattern descriptor\fP

A pattern descriptor should use only valid caracters from the specified alphabet as well as "_" and "[" or "]". These extra caracters allow to consider positions where the pattern could be degenerate: "." means any caracter and the brackets allow to specify a list of authorized caracters. The caracter "|" could also be used as a separator between several patterns in the same descriptor

Here come few examples: 

.IP
"gctgg[tc]gg" expands to {gctggtgg,gctggcgg}
.PP

.IP
"[at]atg.a" expands to {aatgaa,aatgca,aatgga,aatgta,tatgaa,tatgca,tatgga,tatgta}
.PP

.IP
"agct|tgcat" expands to {agct,tgcat}
.PP

\fBFASTA sequence \fP

All sequence must be in FASTA format which is very simple. A text file containing one ore more sequences all starting with a title line which first caracter should be a ">". No more than 100 columns should be used in the file (other caracters will simply be ignored).

Here is a simple example:

.IP
.nf
> sequence 1
atcgtagctagc
atcgatcggtag
aa
> sequence 2
atatattagcta
atagatcgatcg
aatatatag
.fi
.PP

\fBBoth strands \fP

This option allows to complete the patterns with their inverse complementary. This way, occurrences of the pattern on the two strands are taken into account

Some examples:

.IP
-p gctggtgg -b gives the same result than -p gctggtgg|ccaccagc
.PP

.IP
-p tc.a -b gives the same result than -p tc.a|t.ga
.PP

\fBMarkov model order\fP

This determine the order of the Markov model used to modelize the random sequence. By default, its parameters are estimated on the observed sequence using maximum of likelihood. Alternatively the parameters could be provided by a Markov file through the --Use-markov-file option.

order 0 correspond to the independant model and order -1 to the independant and uniform model (no parameter). 

\fBMarkov file\fP

A markov file contain the parameters of a markov model. It is a simple text file where line starting with a "#" are considered as commentary. For an order m model on a size k alphabet, the file must contain k^m non commentary lines each of it containing k real number. Each line correspond to the value of the last m letters (in alphabet order) and the column to the following letter.

Such file is either produced as an output of the program (--Markov-file option) or either used as input parameters (--Use-markov-file option)

\fBStationnary file\fP

A stationnary file contain the stationnary distribution of a Markov model. It is a simple text file where line starting with a "#" are considered as commentary. The file contain k^m lines of one real number for an order m model on a size k alphabet. Such a file can be produced through the (--Stationnary-file option).

\fBPattern file\fP

A pattern file contains a list of pattern descriptor. It is a simple text file where line starting with a "#" are considered as commentary. Each non commentary line is considered as a pattern descriptor.

\fBCount file\fP

A count file contains the number of occurrences of every words of a given length L. It is a simple text file where line starting with a "#" are considered as commentary. On each non commentary line is given a number of occurrence. All words of length L are treated this way in the alphabetic order. 

\fBStatistic Normalization\fP

Statictics usually grow in magnitude with the length of the considered sequence, this is well known in the large
deviations theory and can be simply corrected by considering the normalization provided by the \--normalize option:

normalizedS = - 1/n log10[ P( N(P) > Nobs(P) ) ] when P is seen more than expected

and

normalizedS = + 1/n log10[ P( N(P) < Nobs(P) ) ] when P is seen less than expected
 
where n is the length of the sequence.

\fBmin-pvalue filtering\fP (sspatt only)

Allows to filter the output by producing only statistics for which the corresponding pvalues are lower
than the specified threshold. Please note that in all cases, statistics are computed anyway.

.SH EXAMPLES

Count all occurrencies of two letter words in the DNA sequence
contained in the \fIseq.fasta\fP file:

.IP
sspatt --all-words -l 2 seq.fasta
.PP

Compute the statistics of all two letter words in the sequence
contained in \fIseq.fasta\fP, according to à 0 order Markov
model. Store the parameters of the model in file \fImarkov\fP:

.IP
sspatt --all-words -l 2 seq.fasta -m 0 -M markov
.PP

A simple word:

.IP
.nf
$ sspatt ecoli.fasta -p gctggtgg -m 1
gctggtgg        499     70.10   +240.760141
.fi
.PP

An order 1 Markov model is estimated on the sequence ecoli.fasta and statistic in log scale (default) is outputed for pattern gctggtgg. We observe 499 occurrences, expect 70.10, so the pattern is over-represented with a p-value around 1e-240.

A more complex pattern: 

.IP
.nf
$ sspatt ecoli.fasta -p g.tggtgg -m 0
g.tggtgg        1043    294.63  +249.394597
.fi
.PP

Statistics for pattern {gatggtgg,gctggtgg,ggtggtgg,gttggtgg} are computed first for an order 0 Markov model. We observe 1043 occurrences expecting only 294.63 of them. The pattern is over-represented with a p-value around 1e-249.

All words of a given length:

.IP
.nf
$ sspatt ecoli.fasta -l 4 -m 2 --all-words
aaaa    35124   35104.19        +0.338697
aaac    25253   26618.98        -16.893008
aaag    22788   20425.36        +59.038597
aaat    25736   26752.44        -9.738282
aaca    21870   18864.77        +100.972531
aacc    20444   24098.25        -128.653351
aacg    24404   23571.88        +7.477807
(...)
.fi
.PP

Statistics for all words of length 4 are computed for an order 2 Markov model.

A very long pattern:

.IP
.nf
$ sspatt swissprot.fasta -l 3 -m 2 -a ARNDCEQGHILKMFPSTWYV \\
-p PNEKVVGIYRMTTPSVLLRDLDIIKHVLIKDFESFADRGVEF
PNEKVVGIYRMTTPSVLLRDLDIIKHVLIKDFESFADRGVEF      1       1.998352e-45    +44.699328
.fi
.PP

Computes the statistic for the (very) long pattern specified on the aminoacid alphabet. As this alphabet has a high cardinal (20), a shorter length for the counted words than the default one must be used (this explains the -l 3 parameter). One occurrence is observed, 2e-45 is expected resulting in an over-representation with a p-value around 1e-44.

.SH AUTHORS
Grégory Nuel \fI<nuel@genopole.cnrs.fr>\fP
and Mark Hoebeke \fI<Mark.Hoebeke@jouy.inra.fr\fP
 

